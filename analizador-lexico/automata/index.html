<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Autómata Léxico</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.3.0/raphael.min.js"></script>
    <style>
        body {
            font-family: sans-serif;
            text-align: center;
            background-color: #f0f4f8;
        }

        #canvas-container {
            width: 100%;
            overflow-x: auto;
        }

        #canvas {
            width: 3000px;
            height: 500px;
            border: 1px solid #ccc;
            background-color: #ffffff;
        }

        #tokens {
            margin-top: 20px;
            text-align: left;
            width: 90%;
            margin-left: auto;
            margin-right: auto;
            background: #ffffff;
            padding: 1rem;
            border-radius: 0.5rem;
            box-shadow: 0px 0px 8px rgba(0,0,0,0.1);
        }

        .error {
            color: red;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <h2>Autómata Léxico (Visualización Dinámica)</h2>
    <div id="canvas-container">
        <div id="canvas"></div>
    </div>
    <div id="tokens">Cargando tokens...</div>

    <script>
        const canvasWidth = 10000;
        const paper = Raphael("canvas", canvasWidth, 500);
        const circleRadius = 30;
        const startX = 60;
        const startY = 200;
        const gap = 100;

        fetch("tokens.json")
            .then(res => res.json())
            .then(tokens => {
                const div = document.getElementById("tokens");
                div.innerHTML = "<h3>Tokens Reconocidos:</h3>";

                tokens.forEach((t, i) => {
                    const span = document.createElement("div");
                    span.textContent = `${i + 1}. [${t.tipo}] → "${t.valor}"`;
                    if (t.tipo === "ERROR") span.classList.add("error");
                    div.appendChild(span);
                });

                const estados = [];
                tokens.forEach((t, i) => {
                    const cx = startX + i * gap;
                    const circle = paper.circle(cx, startY, circleRadius).attr({ fill: "#dbeafe", stroke: "#3b82f6", "stroke-width": 2 });
                    const label = paper.text(cx, startY, t.tipo).attr({ "font-size": 13 });
                    const valor = paper.text(cx, startY + 40, `\"${t.valor}\"`).attr({ "font-size": 11, fill: "#374151" });
                    estados.push({ circle, label, valor });

                    if (i > 0) {
                        const x1 = startX + (i - 1) * gap + circleRadius;
                        const x2 = cx - circleRadius;
                        paper.path(`M${x1},${startY}L${x2},${startY}`).attr({ stroke: "#4b5563", "stroke-width": 2 });
                        paper.path(`M${x2 - 6},${startY - 5}L${x2},${startY}L${x2 - 6},${startY + 5}`).attr({ fill: "#4b5563" });
                    }
                });

                let i = 0;
                function animar() {
                    if (i > 0) estados[i - 1].circle.attr({ stroke: "#3b82f6", "stroke-width": 2 });
                    if (i < estados.length) {
                        estados[i].circle.attr({ stroke: "#ef4444", "stroke-width": 4 });
                        i++;
                        setTimeout(animar, 800);
                    }
                }
                animar();
            })
            .catch(() => {
                document.getElementById("tokens").innerText = "❌ No se pudo cargar tokens.json";
            });
    </script>
</body>

</html>